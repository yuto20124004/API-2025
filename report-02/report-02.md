
##  API実習　2025　課題レポート（第2回）修正版

  
###  出題範囲：　API実習2025　第4回～第6回まで

###  提出期限：　2025/12/15(月) 17:00

## 出題範囲
- **API実習(4)**：レスポンスデータ設計、JSON/JSONP、フォーマット指定、セキュリティ（XSS, CSRF）、Same-Origin Policy、CORS
- **API実習(5)**：レスポンス項目命名規則、エラー設計、HTTPステータスコード、日付フォーマット、識別子設計
- **API実習(6)**：HTTP仕様、キャッシュ制御、メディアタイプ、コンテンツネゴシエーション、ステータスコード詳細


## 提出形式
- 各問に対して **400～600字程度の解答**を記述
- 図や表を用いる場合はMarkdown記法で挿入



## 課題一覧

### 問1：HTTPステータスコードの分類と役割
HTTPステータスコードは100番台から500番台まで分類されています。それぞれのカテゴリ（情報、成功、リダイレクト、クライアントエラー、サーバエラー）について、**代表的なコードと意味を3つずつ挙げ、API設計でどのような場面で使うか具体例を示してください**。

100:クライアントが送ったリクエストの初期部分を受け取り、送信してよい合図
101:サーバーが別のプロトコルへ切り替える
102:リクエストを処理中だが、結果が出ていない
200:リクエストは成功
201:リクエストは成功し、新しいソースが生成
202:リクエストは成功・受理
300:複数のリソースが存在する
301:リソースが恒久的に移動した
302:リクエストしたリソースのURLが一時的に変更
400:リクエストが正しくない
401:認証が必要
403:アクセスが禁止されている
500:サーバー側でエラーが発生
502:上流サーバーから不正な応答を受け取った
503:サ－バーが一時的に利用不可
100番台はプロトコルの切り替えや巨大なデータの送信時の合図として使われる。200番台は通常の成功レスポンス（作成・取得・削除）。300番台はAPIのURL移転やCDNへのリダイレクト、キャッシュ制御。400番台はバリデーション、認識・認可、レート制限、存在しないリソースの報告。500番台はサーバー内部エラー、障害、外部サービスの問題の報告。に使われる。

---

### 問2：JSONとXMLの比較
WebAPIのレスポンス形式としてJSONが主流になった理由を、**XMLとの比較で3つ以上挙げて説明してください**。また、**JSONPの仕組みと利用目的、セキュリティ上の問題点を簡潔にまとめてください**。

WebAPIのレスポンス形式としてJSONが主流になった理由としては、まずXMLと比べて データサイズが小さく通信が高速である点が挙げられる。XMLはタグが多く冗長になりやすいのに対し、JSON はシンプルな構造のため軽量で扱いやすい。またJSONは JavaScriptと記法が共通しているため ブラウザやフロントエンドとの親和性が高く、パース速度も速い。多くの言語で標準的にサポートされていることや、可読性が高いことも利点である。さらに、軽量で状態を持たない通信を重視するREST APIの設計思想と相性が良いことから、WebAPI では XML より JSON が一般的に採用されるようになった。次にJSONPとは、APIがJSONの代わりに JavaScript の関数呼び出し形式でデータを返す仕組みであり、同一生成元ポリシーを回避して他ドメインのAPI アクセスするために利用されていた。CORS が普及する以前は、別ドメインからデータを取得する手段として広く用いられていたが、JSONPには 任意のスクリプトが実行される危険性があり、改ざんされたAPIから悪意あるコードを読み込んでしまうと即実行されるという重大なリスクがある。また、GETメソッドしか利用できず、リクエスト内容が盗み見られる可能性もある。このような理由から、現在ではより安全なCORSが主流となり、JSONPは推奨されていない。

---

### 問3（実演）：PostmanでSheetDB APIにGETリクエスト
- 無償で利用できるSheetDBの公開エンドポイントを使い、Postmanで`GET`リクエストを送信してください。
- **操作手順**：
  1. Postmanを起動し、新規リクエストを作成
  2. メソッドを`GET`に設定
  3. URLに以下を入力：`https://sheetdb.io/api/v1/58f61be4dda40`
  4. Sendをクリック
- **報告内容**：
  - ステータスコード
  - レスポンスヘッダ（`Content-Type`など）
  - レスポンスJSONのスクリーンショット
<img width="1170" height="547" alt="スクリーンショット 2025-12-09 113534" src="https://github.com/user-attachments/assets/2847c864-7747-4fbb-8dc2-2a9a45a7603a" />

<img width="1416" height="875" alt="image" src="https://github.com/user-attachments/assets/396b42b9-ed20-4ebf-9ede-2e9529a1c6e0" />

<img width="1160" height="866" alt="スクリーンショット 2025-12-09 113807" src="https://github.com/user-attachments/assets/6f19f2d0-1af7-4bf7-b7a3-b9bfecfc1eae" />

---

### 問4：キャッシュ制御の仕組み
HTTPキャッシュの2つのモデル（Expiration ModelとValidation Model）について、**仕組みと利用シーンを説明してください**。また、以下のヘッダの意味を答えてください。
```

HTTP キャッシュには「Expiration Model」と「Validation Model」の2つの方式がある。まずExpiration Model（有効期限モデル）は、サーバーがレスポンスに「このデータは一定時間キャッシュしてよい」という有効期限を示す方式である。
Cache-Control: max-age=3600やExpiresヘッダが代表的で、クライアントは期限内であればサーバーへ問い合わせずローカルキャッシュをそのまま利用する。更新がほとんどない画像、CSS、JavaScript などの静的ファイルに適しており、
サーバー負荷の軽減やレスポンスの高速化に大きく貢献する。
一方でValidation Model（検証モデル）は、キャッシュが最新かどうかをサーバーに問い合わせて確認する仕組みである。
サーバーはリソースにETagやLast-Modifiedを付与し、クライアントは次回アクセス時にIf-None-MatchやIf-Modified-Sinceを送って変更の有無を確認する。
更新がなければサーバーは304 Not Modifiedを返し、クライアントは既存のキャッシュを継続利用する。商品情報やニュース一覧など、変更される可能性はあるが毎回取得する必要がない動的データに向いている。
このように、Expiration Modelは更新頻度が低い静的データの高速配信に、Validation Modelは更新可能性のあるデータの効率的な取得に適しており、場面に応じて使い分けられている。

Cache-Control: max-age=3600
・取得して「3600秒（1時間）」の間はキャッシュしてよい。有効期限内であれば、クライアントはサーバー再アクセスせず、ローカルキャッシュをそのまま利用できる。
Expires: Tue, 14 Dec 2021 00:00:00 JST
・指定された時間までをキャッシュしてよいという有効期限を絶対自国で示すヘッダ。Cache-Controlがない場合に利用されるが、同時に指定されている場合はCache-Controlが優先される
ETag: "abc123"
・このリソースのバージョン識別子・タグ。クライアントは次回アクセスしたときにIf-None-Match: "abc123"を送りリソースが変更されたか確認する。変更がなければサーバーは304 Not Modifiedを返し、キャッシュを継続利用させる。
```

---

### 問5（実演）：レスポンスJSONの分析
- 問3で取得したレスポンスJSONを分析し、**キーの命名規則（キャメルケース、スネークケースなど）と構造の特徴をまとめてください**。
- **報告内容**：
  - 実際のレスポンス例
[
          {
              "id": "1",
              "name": "Tom",
              "age": "15",
              "comment": ""
          },
          {
              "id": "2",
              "name": "Alex",
              "age": "24",
              "comment": ""
          },
          {
              "id": "3",
              "name": "John",
              "age": "51",
              "comment": ""
          },
          {
              "id": "4",
              "name": "Steve",
              "age": "22",
              "comment": "special"
          },
          {
              "id": "5",
              "name": "James",
              "age": "19",
              "comment": ""
          }
]
  - 命名規則の評価
    キーはすべて小文字の英単語で命名されている。
  - 構造の特徴
    レスポンスJSONは単一のオブジェクトで構成され、フック数のキーと値のペアを持つフラットな構造。

---

### 問6：エラー設計と詳細情報
APIでエラーが発生した場合、HTTPステータスコードだけでなく詳細情報を返すことが推奨されます。**以下の観点でエラー情報設計のポイントをまとめてください**。
- 開発者向けメッセージと利用者向けメッセージの違い
  ・開発者向けのエラーメッセージ：何が原因でエラーになったかを技術的に説明し、パラメータ不足やバリデーション失敗の種類などの具体的にし、開発者がデバック時に問題を特定しやすい。
  ・利用者向けのエラーメッセージ：一般ユーザが読んでも意味が分かる内容で技術的な内部情報は含めずに、わかりやすく状況だけを説明し、セキュリティ的に不必要な情報を漏らさないようにする。
- エラー原因の分類（例：認証、権限、リソース不在）
  ・認証（Authentication）：トークンなし、期限切れ、形式不足（401 Unauthorized)
  ・権限（Authorization）：認証は通過したが、操作する権限がない(403 Forbidden)
  ・リソース不足（Resourse Not Found）：指定されたIDのデータが存在しない(404 Not Found)
  ・バリエーション,パラメータエラー：入力値不足、不正フォーマット(400 Bad Request)
  ・サーバー内部エラー：想定外の例外、DB障害(500 Internal Server Error)
- ドキュメントURLの付与の意義
  ドキュメントURLをエラーレスポンスに付与することでAPI利用者や開発者は発生したエラーの詳細な仕様や原因、対処方法を確認できるようになる。エラーの自己解決がしやすくなったりエラー内容をコードやURLで一元管理できるため仕様変更やバージョン更新があっても説明を統一しやすく、API全体の保全性と利用者の利便性を向上させることができる・

---

### 問7：日付フォーマットと国際化
APIレスポンスで日付を扱う場合、RFC 3339（ISO8601）形式が推奨されます。**以下の3つのフォーマットの違いを説明し、どの形式を採用すべきか理由を述べてください**。
- `Sun, 05 Dec 2021 07:57:37 GMT`（RFC 1123）
  ・HTTPヘッダで使われる常識で英語の曜日・月名を含み人には読みやすいが表記が固定で厳密だが、APIレスポンスのJOSNで扱うには冗長
- `2021-12-05T12:34:56+09:00`（RFC 3339）
  ・日付と時刻を数値で表現しタイムゾーンも表記されている。多くのプログラミング言語・ライブラリが標準対応しており、JSONとの親和性が高く国際化にも対応しやすい。ソートや比較がしやすく、機械処理が向いている。
- `Sun Dec 5 12:34:56 2021`（asctime形式）
  ・C言語のasctime()に由来する人向けの表記。曜日と月名が英語固定でフォーマットが曖昧。タイムゾーン情報が含まれず解析ミスの原因になりやすく、APIには不向き。

  ・APIレスポンスではRFC3339(ISO 8601)形式を採用すべき。理由は機械処理に適しておりタイムゾーンが明示されていて誤解が生じにくく、JSONとの相性が良いため。

---

### 問8（実演）：Acceptヘッダの実験
- Postmanで`Accept`ヘッダを`application/json`と`text/html`に変えてSheetDB APIにリクエストし、レスポンスの違いを確認してください。
- **報告内容**：
  - それぞれのレスポンスのスクリーンショット
    ・application/json
    <img width="1194" height="830" alt="image" src="https://github.com/user-attachments/assets/8304c1f1-6ccb-4702-91dd-4edce006f6b0" />
    ・text/html
    <img width="1260" height="839" alt="image" src="https://github.com/user-attachments/assets/fb157325-aea2-43d8-86ae-033981aba10c" />

  - 違いの説明
    主な用途、データ方式、処理対象、APIの向き不向きに違いがある。
    ・application/json
    Web API、JSON、プログラム、とても向いている
    ・text/html
    Webページ、HTML、人、向いていない
---

### 問9：セキュリティ対策（XSS・CSRF）
WebAPI利用時に発生しうるXSSとCSRF攻撃について、**攻撃の仕組みと被害例を説明し、それぞれの対策を3つずつ挙げてください**。また、**Same-Origin PolicyとCORSの関係を簡潔にまとめてください**。

・XSSはユーザ入力に悪意あるスクリプトを埋め込みそれをほかのユーザのブラウザ上で実行させる攻撃。被害例としては、なりすましログインやフィッシング画面表示による個人情報漏洩が挙げられる。対策としては出力時エスケープの徹底、入力値のバリデーション、CSPの導入が挙げられる。
・CSRFはユーザがログイン済みであることを悪用し、攻撃者が用意した別サイトから意図しないリクエストを自動送信させる攻撃。ブラウザは自動的にCookieを送信するためAPI側は正規ユーザの操作と誤認する。被害例はパスワード・メールアドレスの変更、不正な投稿やデータの削除、管理者権限での設定変更。対策は、CSRFトークンの利用やSameSite Cookie属性の設定、重要操作をPOST/PUT/DELETEに限定するがあげられる。
・Same-Origin Polisyはブラウザの基本的なセキュリティ規制が主な仕事。CORS（Cross-Origin Resource Sharing）はSOPを安全に緩和する仕組み。この二つの関係としては「SOPがデータの壁を作るのが仕事でCORSがサーバーがその壁に扉を開ける仕組み」である。


---

### 問10：コンテンツネゴシエーション
HTTPのコンテンツネゴシエーションにおいて、**Acceptヘッダとq値（品質値）の役割を説明し、以下の例でサーバがどのメディアタイプを選択するか理由を述べてください**。
```
Acceptヘッダはクライアントが受け取れるメディアタイプとその優先順位をサーバーに伝える役割。q値（品質値）は各メディアタイプの優先度を表す数値で、0～1の範囲で大きいほど優先順位が高い。デフォルトは1.0。サーバーが対応している形式を確認し、Acceptに含まれる形式と照合しq値が一番高いものを選択しその形式でレスポンスを返す。
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
text/htmlが選択されると思う。まずq値をもとにapplication/xmlと*/*は優先順位がほかの3つに比べ低いので除外。application/xhtml+xmlはXHTMLを厳密に生成できるサーバーは少ないためtext/htmlが優先されるため選択肢から除外。最後にimage/webpは<img>のリクエスト用でHTMLドキュメントのレスポンスとしては不適切なので除外。よって、消去法でtext/htmlが選択されると思う。

```
